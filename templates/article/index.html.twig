{% extends 'base.html.twig' %}

{% block title %}Hello ArticleController!{% endblock %}

{% block body %}


<!-- search area -->
	<div class="search-area">
		<div class="container">
			<div class="row">
				<div class="col-lg-12">
					<span class="close-btn"><i class="fas fa-window-close"></i></span>
					<div class="search-bar">
						<div class="search-bar-tablecell">
							<h3>Search For:</h3>
							<input type="text" placeholder="Keywords">
							<button type="submit">Search <i class="fas fa-search"></i></button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- end search arewa -->
	
	<!-- breadcrumb-section -->
	<div class="breadcrumb-section breadcrumb-bg">
		<div class="container">
			<div class="row">
				<div class="col-lg-8 offset-lg-2 text-center">
					<div class="breadcrumb-text">
						<p>Organic Information</p>
						<h1>News Article</h1>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- end breadcrumb section -->

	<!-- latest news -->
	 <div class="latest-news mt-150 mb-150">
         <div class="container">
		<div class="search-bar-container text-end mb-4" style="text-align: right;">
    <input type="text" id="searchInput" placeholder="Rechercher un article..." style="padding: 5px; border: 1px solid #ccc; border-radius: 5px;">
</div>
		<div class="product-filters text-center mb-4">
    <ul>
        <li class="filter-btn active" data-filter="*">ALL</li>
        <li class="filter-btn" data-filter=".Peinture">Peinture</li>
        <li class="filter-btn" data-filter=".Sculpture">Sculpture</li>
        <li class="filter-btn" data-filter=".Photographie">Photographie</li>
        <li class="filter-btn" data-filter=".Céramique">Céramique</li>
    </ul>
</div>
            <div class="row">
                {% for article in articles %}
				<div class="col-lg-4 col-md-6 article-item {{ article.categorie|lower }}">
                    
                        <div class="single-latest-news">
                            <a href="{{ path('appp_article', {'id': article.id}) }}">
                                {% if article.image %}
                                    <div class="latest-news-bg" style="background-image: url('{{ asset('assets/back-office/images/' ~ article.image) }}');"></div>
                                {% else %}
                                    <div class="latest-news-bg news-bg-1"></div>
                                {% endif %}
                            </a>
                            <div class="news-text-box">
                                <h3><a href="{{ path('appp_article', {'id': article.id}) }}">{{ article.titre|slice(0, 10) ~ '...' }}</a></h3>
                                <p class="blog-meta">

                                    <span class="author"><i class="fas fa-user"></i> {{ article.nomAuteur }}</span>
                                    <span class="date"><i class="fas fa-calendar"></i> {{ article.datepub|date('Y-m-d') }}</span>
									 <span class="author"><i class="fas fa-user"></i> {{article.views}}</span>
                                </p>
                                <p class="excerpt">{{ article.contenu|slice(0, 100) }}...</p>
								<p><strong>Catégorie :</strong> {{ article.categorie }}</p>
                                <a href="{{ path('article_details', {'id': article.id}) }}" class="read-more-btn">Lire plus <i class="fas fa-angle-right"></i></a>
                           
 </div>
                        </div>
                    </div>
                {% else %}
                    <p>Aucun article trouvé.</p>
                {% endfor %}
            </div>
        </div>
    </div>

			<div class="row">
				<div class="container">
					<div class="row">
						<div class="col-lg-12 text-center">
							<div class="pagination-wrap">
								<ul>
									<li><a href="#">Prev</a></li>
									<li><a href="#">1</a></li>
									<li><a class="active" href="#">2</a></li>
									<li><a href="#">3</a></li>
									<li><a href="#">Next</a></li>
								</ul>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- end latest news -->

	<!-- logo carousel -->
	<div class="logo-carousel-section">
		<div class="container">
			<div class="row">
				<div class="col-lg-12">
					<div class="logo-carousel-inner">
						<div class="single-logo-item">
							<img src="assets/img/company-logos/1.png" alt="">
						</div>
						<div class="single-logo-item">
							<img src="assets/img/company-logos/2.png" alt="">
						</div>
						<div class="single-logo-item">
							<img src="assets/img/company-logos/3.png" alt="">
						</div>
						<div class="single-logo-item">
							<img src="assets/img/company-logos/4.png" alt="">
						</div>
						<div class="single-logo-item">
							<img src="assets/img/company-logos/5.png" alt="">
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- end logo carousel -->
<script>
document.addEventListener('DOMContentLoaded', function () {
    const filterButtons = document.querySelectorAll('.filter-btn');
    const articles = document.querySelectorAll('.article-item');

    filterButtons.forEach(button => {
        button.addEventListener('click', function () {
            const filter = this.getAttribute('data-filter').toLowerCase();  // Convertir le filtre en minuscule

            filterButtons.forEach(btn => btn.classList.remove('active'));
            this.classList.add('active');

            articles.forEach(article => {
                const articleCategories = article.classList;

                if (filter === '*' || articleCategories.contains(filter.replace('.', ''))) {
                    article.style.display = 'block';
                } else {
                    article.style.display = 'none';
                }
            });
        });
    });
});

</script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('searchInput');
    const articleContainer = document.querySelector('.latest-news .row');

    let timer;
    searchInput.addEventListener('input', function() {
        clearTimeout(timer);
        timer = setTimeout(() => fetchArticles(searchInput.value), 500);
    });

    function fetchArticles(query) {
        fetch('/articles/search?q=' + encodeURIComponent(query), {
            headers: { 'X-Requested-With': 'XMLHttpRequest' }
        })
        .then(response => response.json())
        .then(data => {
            articleContainer.innerHTML = ''; // Vider les articles actuels

            if (data.articles.length === 0) {
                articleContainer.innerHTML = '<p>Aucun article trouvé.</p>';
            } else {
                data.articles.forEach(article => {
                    const html = `
                        <div class="col-lg-4 col-md-6 article-item ${article.categorie.toLowerCase()}">
                            <div class="single-latest-news">
                                <a href="/article/${article.id}">
                                    <div class="latest-news-bg" style="background-image: url('/assets/back-office/images/${article.image}'); height: 200px; background-size: cover;"></div>
                                </a>
                                <div class="news-text-box">
                                    <h3><a href="/article/${article.id}">${article.titre.substring(0, 20)}...</a></h3>
                                    <p class="blog-meta">
                                        <span class="author"><i class="fas fa-user"></i> ${article.nomAuteur}</span>
                                        <span class="author"><i class="fas fa-user"></i> ${article.views}</span>

                                        <span class="date"><i class="fas fa-calendar"></i> ${article.datepub}</span>
                                    </p>
                                    <p class="excerpt">${article.contenu.substring(0, 100)}...</p>
                                    <p><strong>Catégorie :</strong> ${article.categorie}</p>
                                    <a href="/article/${article.id}" class="read-more-btn">Lire plus <i class="fas fa-angle-right"></i></a>
                                </div>
                            </div>
                        </div>`;
                    articleContainer.innerHTML += html;
                });
            }
        });
    }
});
</script>
{% endblock %}
